<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Security: Basic CSP to prevent unauthorized script injection -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval';">
    <meta name="description" content="RechargEarth: Celebrate life milestones by planting trees. Join the movement to restore the planet.">
    <meta name="theme-color" content="#064e3b">
    <title>RechargEarth | Plant for the Future</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ±</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { primary: '#064e3b', secondary: '#10b981', accent: '#f59e0b', light: '#f0fdf4', dark: '#111827' },
                    fontFamily: { serif: ['Playfair Display', 'serif'], sans: ['Montserrat', 'sans-serif'] },
                    boxShadow: { 'soft': '0 20px 40px -15px rgba(6, 78, 59, 0.1)', 'glow': '0 0 20px rgba(16, 185, 129, 0.3)' },
                    animation: { 'float': 'float 6s ease-in-out infinite' },
                    keyframes: { float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } } }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Montserrat', sans-serif; transition: background-color 0.3s ease, color 0.3s ease; overflow-x: hidden; color: #111827; background-color: #f0fdf4; }
        html.dark body { color: #e5e7eb; background-color: #030712; }
        
        /* Hero fallback background */
        .hero-section { background-color: #064e3b; position: relative; height: 100vh; min-height: 600px; background-image: url('https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?ixlib=rb-4.0.3&auto=format&fit=crop&w=2074&q=80'); background-size: cover; background-position: center; background-attachment: fixed; }
        .hero-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(6, 78, 59, 0.5) 60%, rgba(6, 78, 59, 0.95) 100%); }

        /* Header Styling */
        #header { transition: all 0.3s ease; }
        #header.scrolled { background-color: rgba(240, 253, 244, 0.95); backdrop-filter: blur(12px); box-shadow: 0 4px 30px rgba(6, 78, 59, 0.05); padding-top: 12px; padding-bottom: 12px; border-bottom: 1px solid rgba(6, 78, 59, 0.05); }
        html.dark #header.scrolled { background-color: rgba(3, 7, 18, 0.95); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        
        /* Header Text Colors */
        #header.scrolled .nav-text { color: #064e3b !important; font-weight: 600; }
        html.dark #header.scrolled .nav-text { color: #e5e7eb !important; }
        
        #header.scrolled .logo-text, #header.scrolled .cart-icon, #header.scrolled .theme-toggle { color: #064e3b !important; }
        html.dark #header.scrolled .logo-text { color: #10b981 !important; }
        html.dark #header.scrolled .cart-icon { color: #e5e7eb !important; }
        html.dark #header.scrolled .theme-toggle { color: #f59e0b !important; }
        
        #header.scrolled .auth-btn { color: #064e3b !important; border-color: #064e3b !important; }
        #header.scrolled .auth-btn:hover { background-color: #064e3b !important; color: white !important; }
        html.dark #header.scrolled .auth-btn { color: #10b981 !important; border-color: #10b981 !important; }
        html.dark #header.scrolled .auth-btn:hover { background-color: #10b981 !important; color: #064e3b !important; }
        
        /* Unscrolled state - ensure white text over hero */
        #header:not(.scrolled) .nav-text, 
        #header:not(.scrolled) .logo-text, 
        #header:not(.scrolled) .cart-icon, 
        #header:not(.scrolled) .theme-toggle { color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        
        /* Preserve accent color for admin button even when unscrolled */
        #header:not(.scrolled) button.text-accent { color: #f59e0b !important; border-color: #f59e0b !important; }

        /* Mobile Menu Fallback */
        #mobile-menu { background-color: #ffffff; }
        html.dark #mobile-menu { background-color: #111827; }

        .product-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15); }
        html.dark .product-card:hover { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        
        .wave-top path { fill: #FFFFFF; transition: fill 0.3s ease; }
        html.dark .wave-top path { fill: #111827; }
        svg { display: block; }

        #toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 9999; pointer-events: none; }
        .toast { pointer-events: auto; animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-active { display: flex !important; }
        #admin-panel { display: none; }
        #admin-panel.open { display: block; }
        
        /* Ensure content is visible by default */
        .reveal { opacity: 1; transform: none; transition: all 0.8s cubic-bezier(0.5, 0, 0, 1); }
        .reveal.active { opacity: 1; transform: none; }

        /* User Menu Dropdown */
        .user-menu-content {
            display: none;
        }
        .user-menu-content.show {
            display: block;
        }
        
        /* Toast styling */
        .toast { background: white; padding: 1rem; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: flex; gap: 0.75rem; align-items: center; margin-bottom: 1rem; }
        html.dark .toast { background: #1f2937; }
    </style>
    <script>
        // Ensure text is visible immediately
        (function() {
            document.documentElement.style.color = '#111827';
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
                document.documentElement.style.color = '#e5e7eb';
            }
        })();
    </script>
</head>
<body class="text-dark bg-light dark:bg-gray-950 dark:text-gray-200 selection:bg-accent selection:text-primary">

    <div id="toast-container"></div>

    <!-- ADMIN DASHBOARD -->
    <div id="admin-panel" class="fixed inset-0 z-[120] bg-gray-50 dark:bg-gray-900 hidden flex-col animate-[fadeIn_0.3s_ease-out]">
        <div class="bg-white dark:bg-gray-800 shadow-md border-b border-gray-200 dark:border-gray-700 p-4 flex justify-between items-center sticky top-0 z-20">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 bg-primary text-white rounded-lg flex items-center justify-center shadow-lg"><i class="fas fa-leaf"></i></div>
                <div><h2 class="text-lg font-bold text-gray-800 dark:text-white leading-none">Admin Portal</h2><p class="text-xs text-green-600 dark:text-green-400 font-bold mt-1 tracking-wide">SECURE SESSION ACTIVE</p></div>
            </div>
            <div class="flex gap-4">
                <div class="flex bg-gray-100 dark:bg-gray-700 p-1 rounded-lg">
                    <button onclick="switchAdminTab('pledges')" id="tab-pledges" class="px-4 py-1.5 rounded-md text-sm font-bold bg-white dark:bg-gray-600 shadow-sm text-primary dark:text-white transition-all">Pledges</button>
                    <button onclick="switchAdminTab('products')" id="tab-products" class="px-4 py-1.5 rounded-md text-sm font-bold text-gray-500 dark:text-gray-400 hover:text-primary transition-all">Products</button>
                </div>
                <button onclick="document.getElementById('admin-panel').classList.remove('open')" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 w-10 h-10 rounded-full flex items-center justify-center transition-all focus:outline-none"><i class="fas fa-times"></i></button>
            </div>
        </div>
        <div class="flex-1 overflow-auto p-6 md:p-8">
            <div class="max-w-7xl mx-auto">
                <div id="view-pledges" class="block animate-[fadeIn_0.4s_ease-out]">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
                        <div class="p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center"><h3 class="font-bold text-lg text-gray-800 dark:text-white">Recent Pledge Activity</h3></div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-gray-50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400 text-xs uppercase font-bold tracking-wider"><tr><th class="p-5">Date</th><th class="p-5">Name</th><th class="p-5">Contact</th><th class="p-5 text-right">Actions</th></tr></thead>
                                <tbody id="pledge-table-body" class="text-sm text-gray-700 dark:text-gray-300 divide-y divide-gray-100 dark:divide-gray-700"></tbody>
                            </table>
                        </div>
                        <div id="empty-state" class="p-12 text-center text-gray-400 hidden"><i class="far fa-folder-open text-4xl mb-3 opacity-50"></i><p>No data found.</p></div>
                        <div id="loading-state" class="p-12 text-center text-gray-500"><i class="fas fa-circle-notch fa-spin text-2xl mb-2 text-primary"></i><p>Loading...</p></div>
                    </div>
                </div>
                <div id="view-products" class="hidden animate-[fadeIn_0.4s_ease-out]">
                    <div class="flex flex-col lg:flex-row gap-8">
                        <div class="lg:w-1/3">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 sticky top-24">
                                <h3 class="font-bold text-lg text-gray-800 dark:text-white mb-4">Add New Package</h3>
                                <form onsubmit="handleAddProduct(event)" class="space-y-4">
                                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Package Name</label><input type="text" name="name" placeholder="e.g. Family Forest" class="w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-transparent focus:border-primary outline-none dark:text-white" required></div>
                                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Price (â‚¹)</label><input type="number" name="price" placeholder="e.g. 1500" class="w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-transparent focus:border-primary outline-none dark:text-white" required></div>
                                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Image URL</label><input type="url" name="image" placeholder="https://..." class="w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-transparent focus:border-primary outline-none dark:text-white" required></div>
                                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Description</label><textarea name="desc" rows="3" placeholder="Short description..." class="w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-transparent focus:border-primary outline-none dark:text-white" required></textarea></div>
                                    <button type="submit" class="w-full bg-primary text-white font-bold py-3 rounded-lg hover:bg-emerald-900 transition-all flex items-center justify-center gap-2"><i class="fas fa-plus-circle"></i> Add Product</button>
                                </form>
                            </div>
                        </div>
                        <div class="lg:w-2/3">
                            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
                                <div class="p-6 border-b border-gray-100 dark:border-gray-700"><h3 class="font-bold text-lg text-gray-800 dark:text-white">Active Products</h3></div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead class="bg-gray-50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400 text-xs uppercase font-bold tracking-wider"><tr><th class="p-4">Image</th><th class="p-4">Details</th><th class="p-4 text-right">Actions</th></tr></thead>
                                        <tbody id="admin-product-list" class="text-sm text-gray-700 dark:text-gray-300 divide-y divide-gray-100 dark:divide-gray-700"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AUTH MODAL -->
    <div id="auth-modal" class="fixed inset-0 z-[105] bg-primary/60 dark:bg-black/80 items-center justify-center p-4 backdrop-blur-md opacity-0 hidden transition-opacity duration-500" aria-modal="true" role="dialog">
        <div class="bg-white dark:bg-gray-800 w-full max-w-4xl h-auto max-h-[85vh] relative rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row transform scale-95 transition-transform duration-500 border border-white/10" id="auth-modal-content">
            <button onclick="closeAuthModal()" class="absolute top-6 right-6 z-30 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-dark dark:text-white w-10 h-10 rounded-full flex items-center justify-center transition-all focus:outline-none"><i class="fas fa-times"></i></button>
            <div class="hidden md:block w-1/2 bg-cover bg-center relative" style="background-image: url('https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?ixlib=rb-4.0.3&auto=format&fit=crop&w=1574&q=80');">
                <div class="absolute inset-0 bg-primary/30 dark:bg-black/40 backdrop-blur-[2px]"></div>
                <div class="absolute bottom-10 left-10 text-white pr-10"><h3 class="text-3xl font-serif font-bold mb-2">Join the Tribe.</h3><p class="text-sm opacity-90">Track your trees, get growth updates, and build your personal forest.</p></div>
            </div>
            <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col justify-center h-full bg-white dark:bg-gray-800 overflow-y-auto">
                <div class="text-center mb-8"><span class="text-primary dark:text-secondary font-bold text-2xl font-serif">RechargEarth</span><p class="text-sm text-gray-400 mt-1">Welcome back, Guardian.</p></div>
                <button onclick="handleGoogleLogin()" class="w-full bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-700 dark:text-white font-bold py-3 rounded-xl shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 transition-all flex items-center justify-center gap-3 mb-6"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5 h-5" alt="Google"><span>Continue with Google</span></button>
                <div class="flex items-center gap-3 mb-6"><div class="h-px bg-gray-100 dark:bg-gray-700 flex-1"></div><span class="text-xs text-gray-400 font-bold uppercase">Or email</span><div class="h-px bg-gray-100 dark:bg-gray-700 flex-1"></div></div>
                <div class="flex bg-gray-50 dark:bg-gray-900 p-1 rounded-xl mb-6">
                    <button onclick="toggleAuthMode('login')" class="flex-1 py-2 text-sm font-bold rounded-lg transition-all text-primary bg-white dark:bg-gray-700 dark:text-white shadow-sm" id="btn-tab-login">Login</button>
                    <button onclick="toggleAuthMode('signup')" class="flex-1 py-2 text-sm font-bold rounded-lg transition-all text-gray-400 hover:text-primary dark:hover:text-white" id="btn-tab-signup">Sign Up</button>
                </div>
                <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4 block">
                    <input type="email" name="email" placeholder="Email Address" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white" required>
                    <input type="password" name="password" placeholder="Password" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white" required>
                    <button type="submit" class="w-full bg-primary dark:bg-secondary text-white dark:text-gray-900 font-bold py-3.5 rounded-xl hover:bg-emerald-900 dark:hover:bg-emerald-400 transition-all flex items-center justify-center gap-2"><span id="btn-login-text">Sign In</span> <i class="fas fa-arrow-right"></i></button>
                </form>
                <form id="signup-form" onsubmit="handleSignup(event)" class="space-y-4 hidden">
                    <input type="text" name="name" placeholder="Full Name" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white" required>
                    <input type="email" name="email" placeholder="Email Address" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white" required>
                    <input type="password" name="password" placeholder="Create Password" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white" required>
                    <button type="submit" class="w-full bg-accent text-white font-bold py-3.5 rounded-xl hover:bg-yellow-500 transition-all flex items-center justify-center gap-2"><span id="btn-signup-text">Create Account</span> <i class="fas fa-user-plus"></i></button>
                </form>
            </div>
        </div>
    </div>

    <!-- PLEDGE MODAL -->
    <div id="pledge-modal" class="fixed inset-0 z-[100] bg-primary/60 dark:bg-black/80 items-center justify-center p-4 backdrop-blur-sm opacity-0 hidden transition-opacity duration-500" aria-modal="true" role="dialog">
        <div class="bg-white dark:bg-gray-800 w-full max-w-5xl h-auto max-h-[90vh] relative rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row transform scale-95 transition-transform duration-500 border border-white/10" id="pledge-modal-content">
            <button onclick="closePledgeModal()" class="absolute top-6 right-6 z-30 bg-white/20 hover:bg-white dark:bg-black/30 dark:hover:bg-black/50 text-dark dark:text-white backdrop-blur-md w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-lg focus:outline-none"><i class="fas fa-times"></i></button>
            <div class="hidden md:block w-2/5 bg-cover bg-center relative" style="background-image: url('https://images.unsplash.com/photo-1466692476868-aef1dfb1e735?ixlib=rb-4.0.3&auto=format&fit=crop&w=1574&q=80');">
                <div class="absolute inset-0 bg-primary/20 dark:bg-black/40"></div>
                <div class="absolute bottom-0 left-0 right-0 p-8 bg-gradient-to-t from-black/70 to-transparent text-white">
                    <p class="font-serif italic text-2xl mb-2">"A society grows great when elders plant trees whose shade they know they shall never sit in."</p>
                </div>
            </div>
            <div class="w-full md:w-3/5 p-8 md:p-12 bg-white dark:bg-gray-800 flex flex-col overflow-y-auto">
                <div class="mb-8">
                    <div class="inline-block bg-green-100 dark:bg-emerald-900/30 text-primary dark:text-emerald-400 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-3 border border-green-200 dark:border-emerald-800">Official Pledge</div>
                    <h2 class="text-4xl font-serif font-bold text-primary dark:text-white">I Pledge to Plant</h2>
                    <p class="text-gray-500 dark:text-gray-400 mt-2">Join the movement to restore our planet's green cover.</p>
                </div>
                <div id="modal-form-container">
                    <form onsubmit="handleModalPledge(event)" class="space-y-5">
                        <div class="grid grid-cols-2 gap-5">
                            <input type="text" name="firstName" placeholder="Alex" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white placeholder-gray-400" required>
                            <input type="text" name="lastName" placeholder="Smith" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white placeholder-gray-400" required>
                        </div>
                        <div class="grid grid-cols-2 gap-5">
                            <input type="email" name="email" placeholder="alex@earth.com" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white placeholder-gray-400" required>
                            <input type="date" name="birthday" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white text-gray-500 dark:text-gray-400" required>
                        </div>
                        <input type="tel" name="phone" placeholder="+1 (555) 000-0000" class="w-full p-3.5 rounded-xl bg-gray-50 dark:bg-gray-700 border-transparent focus:border-secondary outline-none dark:text-white placeholder-gray-400" required>
                        <div class="pt-4 flex items-center justify-between">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="w-5 h-5 text-primary rounded focus:ring-primary border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700" required>
                                <span class="text-sm text-gray-500 dark:text-gray-400">I agree to the terms</span>
                            </label>
                            <button type="submit" class="bg-primary dark:bg-secondary text-white dark:text-gray-900 px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-emerald-900 dark:hover:bg-emerald-400 transition-all transform hover:-translate-y-1 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"><span>Confirm Pledge</span><i class="fas fa-check-circle"></i></button>
                        </div>
                    </form>
                </div>
                <div id="modal-success" class="hidden flex-col items-center justify-center py-10 text-center">
                    <div class="w-20 h-20 bg-green-100 dark:bg-emerald-900/30 rounded-full flex items-center justify-center mb-4 text-primary dark:text-emerald-400 text-3xl"><i class="fas fa-check"></i></div>
                    <h3 class="text-2xl font-bold text-primary dark:text-white mb-2">Pledge Recorded!</h3>
                    <p class="text-gray-500 dark:text-gray-400 mb-6">Welcome to the family.</p>
                    <button onclick="closePledgeModal()" class="text-primary dark:text-secondary font-bold hover:underline focus:outline-none">Close Window</button>
                </div>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="fixed w-full top-0 z-50 transition-all duration-500" id="header">
        <div class="container mx-auto px-6 flex items-center justify-between py-6 transition-all duration-500 relative" id="header-container">
            <button class="lg:hidden text-2xl text-white transition-colors nav-text focus:outline-none mr-auto" onclick="toggleMobileMenu()" aria-label="Toggle Menu"><i class="fas fa-bars"></i></button>
            <nav class="hidden lg:flex items-center gap-8 flex-1 justify-start">
                <a href="#home" class="text-sm font-bold uppercase tracking-wider nav-text transition-colors focus:outline-none hover:text-accent">Home</a>
                <a href="#services" class="text-sm font-bold uppercase tracking-wider nav-text transition-colors focus:outline-none hover:text-accent">Services</a>
                <a href="#birthday-park" class="text-sm font-bold uppercase tracking-wider nav-text transition-colors focus:outline-none hover:text-accent">Birthday Park</a>
            </nav>
            <a href="#" class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 lg:static lg:transform-none flex flex-row lg:flex-col items-center gap-2 lg:gap-0 group focus:outline-none lg:flex-1 lg:justify-center">
                <div class="text-white dark:text-secondary transition-transform duration-300 group-hover:scale-110 relative logo-text mb-0 lg:mb-1">
                    <svg width="44" height="44" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g class="group-hover:animate-[spin_8s_linear_infinite] origin-center">
                            <circle cx="22" cy="22" r="20" stroke="currentColor" stroke-width="1.5" stroke-dasharray="3 3" class="opacity-60"/>
                            <ellipse cx="22" cy="22" rx="9" ry="20" stroke="currentColor" stroke-width="1" class="opacity-40"/>
                            <line x1="22" y1="2" x2="22" y2="42" stroke="currentColor" stroke-width="1" class="opacity-40"/>
                            <line x1="2" y1="22" x2="42" y2="22" stroke="currentColor" stroke-width="1" class="opacity-40"/>
                        </g>
                        <path d="M22 36C22 36 12 27 12 16C12 10 16.5 6 22 6C27.5 6 32 10 32 16C32 27 22 36 22 36Z" fill="currentColor"/>
                        <path d="M22 36V6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="text-primary/50"/>
                        <path d="M22 14L27 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="text-primary/50"/>
                        <path d="M22 20L29 16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="text-primary/50"/>
                    </svg>
                </div>
                <div class="flex flex-col leading-none select-none text-center">
                    <span class="text-2xl lg:text-3xl font-bold font-serif tracking-tight transition-colors logo-text text-white">Recharg<span class="text-accent">Earth</span></span>
                </div>
            </a>
            <div class="flex items-center gap-5 flex-1 justify-end">
                <button onclick="toggleTheme()" class="relative transition-colors theme-toggle text-white hover:text-accent focus:outline-none hidden sm:inline-block" aria-label="Toggle Theme"><i class="fas fa-moon text-lg dark:hidden"></i><i class="fas fa-sun text-lg hidden dark:inline-block"></i></button>
                <button class="relative transition-colors cart-icon text-white hover:text-accent focus:outline-none" onclick="openCart()" aria-label="Shopping Cart"><i class="fas fa-shopping-bag text-xl"></i><span id="cart-count" class="absolute -top-2 -right-2 bg-accent text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold shadow-sm">0</span></button>
                
                <!-- Secure Admin Link -->
                <div id="admin-trigger" class="hidden">
                    <button onclick="document.getElementById('admin-panel').classList.add('open')" class="text-accent nav-text font-bold text-xs uppercase border border-accent rounded px-2 py-1 hover:bg-accent hover:text-white transition-all">Admin</button>
                </div>
                
                <!-- Auth UI Container -->
                <div id="auth-ui-container" class="hidden md:block">
                    <button onclick="openAuthModal()" class="border-2 px-5 py-2 rounded-full text-sm font-bold transition-all auth-btn border-white/40 text-white hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-accent">Sign In</button>
                </div>

                <button onclick="openPledgeModal()" class="bg-accent hover:bg-yellow-500 text-white dark:text-gray-900 px-6 py-2.5 rounded-full text-sm font-bold shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5 hidden sm:inline-block focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent">Plant Now</button>
            </div>
        </div>
        <div id="mobile-menu" class="bg-white/95 dark:bg-gray-900/95 backdrop-blur-lg shadow-xl lg:hidden hidden absolute w-full left-0 top-full border-t dark:border-gray-700 z-40">
            <div class="flex flex-col p-6 gap-4 text-dark dark:text-white">
                <div class="flex justify-between items-center"><span class="font-bold text-gray-500 dark:text-gray-400">Menu</span><button onclick="toggleTheme()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700"><i class="fas fa-moon dark:hidden"></i><i class="fas fa-sun hidden dark:inline-block text-yellow-400"></i></button></div>
                <a href="#home" class="font-bold py-2 border-b border-gray-100 dark:border-gray-700" onclick="toggleMobileMenu()">Home</a>
                <a href="#services" class="font-bold py-2 border-b border-gray-100 dark:border-gray-700" onclick="toggleMobileMenu()">Services</a>
                <a href="#birthday-park" class="font-bold text-primary dark:text-secondary py-2 border-b border-gray-100 dark:border-gray-700" onclick="toggleMobileMenu()">Birthday Park</a>
                <button id="mobile-auth-btn" onclick="openAuthModal()" class="text-left font-bold text-gray-500 dark:text-gray-300 py-2">Sign In</button>
                <button onclick="toggleMobileMenu(); openPledgeModal()" class="bg-primary dark:bg-secondary text-white dark:text-gray-900 py-3 rounded-lg font-bold w-full text-center mt-2">Plant Now</button>
            </div>
        </div>
    </header>

    <main>
        <section id="home" class="hero-section flex items-center justify-center text-center px-4 relative">
            <div class="hero-overlay"></div>
            <div class="relative z-10 max-w-4xl mx-auto text-white mt-20 reveal">
                <span class="inline-block bg-white/20 backdrop-blur-md border border-white/30 px-4 py-1.5 rounded-full text-accent font-bold tracking-widest uppercase text-xs mb-6 animate-pulse">Recharging the Planet</span>
                <h1 class="text-5xl md:text-7xl font-bold mb-6 leading-tight drop-shadow-lg font-serif">Plant a Tree. <br><span class="italic text-gradient">Grow a Legacy.</span></h1>
                <p class="text-lg md:text-xl mb-10 text-gray-200 max-w-2xl mx-auto font-light leading-relaxed">Join us in planting for a greener future. Celebrate birthdays, anniversaries, and milestones by restoring the planet.</p>
                <div class="flex flex-col sm:flex-row gap-5 justify-center">
                    <button onclick="openPledgeModal()" class="bg-primary hover:bg-emerald-900 text-white font-bold px-9 py-4 rounded-full transition-all shadow-lg transform hover:-translate-y-1 ring-4 ring-primary/30 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent">Start Planting</button>
                    <a href="#about" class="bg-white/10 backdrop-blur-md border border-white/40 hover:bg-white hover:text-primary text-white font-bold px-9 py-4 rounded-full transition-all flex items-center justify-center gap-2"><i class="far fa-play-circle"></i> Our Story</a>
                </div>
            </div>
            <div class="absolute bottom-0 left-0 w-full overflow-hidden leading-none pointer-events-none z-20"><svg class="relative block w-[calc(100%+1.3px)] h-[60px] md:h-[120px]" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M985.66,92.83C906.67,72,823.78,31,743.84,14.19c-82.26-17.34-168.06-16.33-250.45.39-57.84,11.73-114,31.07-172,41.86A600.21,600.21,0,0,1,0,27.35V120H1200V95.8C1132.19,118.92,1055.71,111.31,985.66,92.83Z" class="fill-white dark:fill-gray-800 transition-colors duration-300"></path></svg></div>
        </section>

        <section id="about" class="py-24 bg-white dark:bg-gray-800 relative z-10 transition-colors duration-400">
            <div class="container mx-auto px-6 reveal">
                <div class="flex flex-col md:flex-row items-center gap-16">
                    <div class="md:w-1/2 relative group">
                        <div class="relative z-10 overflow-hidden rounded-[2.5rem] shadow-soft transform transition-transform duration-700 hover:scale-[1.02]"><img src="https://images.unsplash.com/photo-1502082553048-f009c37129b9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" alt="Hands holding soil" width="1000" height="600" class="w-full h-[600px] object-cover" loading="lazy"><div class="absolute inset-0 bg-gradient-to-t from-primary/60 via-transparent to-transparent opacity-60"></div></div>
                        <div class="absolute -bottom-10 -right-10 bg-white dark:bg-gray-700 p-8 rounded-3xl shadow-xl max-w-sm hidden md:block z-20 border-l-4 border-secondary"><p class="font-serif text-xl italic text-primary dark:text-emerald-300 leading-relaxed">"The true meaning of life is to plant trees, under whose shade you do not expect to sit."</p><p class="text-xs text-gray-400 mt-4 font-bold uppercase tracking-widest">â€” Nelson Henderson</p></div>
                    </div>
                    <div class="md:w-1/2">
                        <span class="text-secondary font-bold uppercase tracking-wider text-sm mb-3 block">Our Origin Story</span>
                        <h2 class="text-4xl md:text-5xl font-bold text-primary dark:text-white mb-8 font-serif leading-tight">It Started With a <br><span class="italic text-gradient">Single Seed of Hope</span></h2>
                        <div class="space-y-6 text-gray-600 dark:text-gray-300 text-lg leading-relaxed"><p>We remember a time when the morning air was crisp, and the birds sang louder than the traffic. But as the concrete jungles grew, the green whispers of our earth began to fade into silence.</p><p><strong>RechargEarth wasn't born in a boardroom.</strong> It was born in a barren field, from the heartbreak of watching a once-thriving forest turn to dust. We asked ourselves: <em>What are we leaving behind?</em></p></div>
                        <div class="mt-10"><button onclick="window.location.href='#birthday-park'" class="group text-primary dark:text-secondary font-bold text-lg flex items-center gap-2 hover:gap-4 transition-all">Discover Our Initiatives <i class="fas fa-arrow-right text-accent"></i></button></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="birthday-park" class="py-24 relative bg-light dark:bg-gray-900 transition-colors duration-400">
            <div class="absolute top-0 left-0 w-full overflow-hidden leading-none rotate-180"><svg class="relative block w-[calc(100%+1.3px)] h-[60px] wave-top" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"></path></svg></div>
            <div class="container mx-auto px-6 pt-10 reveal">
                <div class="text-center max-w-3xl mx-auto mb-20"><span class="text-accent font-bold uppercase tracking-[0.2em] text-sm mb-3 block">A RechargEarth Initiative</span><h2 class="text-4xl md:text-6xl font-serif font-bold text-primary dark:text-white mb-6">Celebrate Life.<br>Restore the Earth.</h2><p class="text-gray-500 dark:text-gray-400 text-lg leading-relaxed">From birthdays to weddings, every milestone deserves a legacy.<br><strong>Don't just celebrate the moment. Grow it forever.</strong></p></div>
                <div class="flex flex-col lg:flex-row items-center gap-16 mb-24">
                    <div class="lg:w-1/2 relative"><div class="relative rounded-[3rem] overflow-hidden shadow-2xl group border-8 border-white dark:border-gray-800 transition-colors duration-400 animate-float"><img src="https://images.stockcake.com/public/0/7/d/07de91e2-b3f2-495c-927a-0f71dd411548_large/joyful-planting-activity-stockcake.jpg" alt="Joyful planting activity" width="1000" height="500" class="w-full h-[500px] object-cover transition-transform duration-700 group-hover:scale-105" loading="lazy"><div class="absolute inset-0 bg-gradient-to-t from-primary/90 via-transparent to-transparent"></div><div class="absolute bottom-10 left-10 text-white"><p class="font-serif italic text-3xl mb-2">"Small hands, big impact."</p><p class="text-sm font-bold uppercase tracking-widest opacity-80">- The RechargEarth Community</p></div></div></div>
                    <div class="lg:w-1/2 space-y-8">
                        <h3 class="text-3xl font-bold text-primary dark:text-emerald-400 font-serif">Our Vision: A Forest of Memories</h3>
                        <p class="text-gray-600 dark:text-gray-300 text-lg leading-relaxed"><strong>Birthday Park</strong> is a flagship initiative, but our dream goes beyond just one day. We envision a culture where <em>every</em> special occasion is marked by planting a tree.</p>
                        <ul class="space-y-4"><li class="flex items-center gap-4 p-4 bg-white dark:bg-gray-800 rounded-2xl border border-green-100 dark:border-gray-700 shadow-sm"><div class="w-10 h-10 rounded-full bg-secondary text-white flex items-center justify-center shadow-glow"><i class="fas fa-leaf"></i></div><span class="font-bold text-primary dark:text-white">For Every Occasion</span></li><li class="flex items-center gap-4 p-4 bg-white dark:bg-gray-800 rounded-2xl border border-green-100 dark:border-gray-700 shadow-sm"><div class="w-10 h-10 rounded-full bg-accent text-white flex items-center justify-center shadow-md"><i class="fas fa-gift"></i></div><span class="font-bold text-primary dark:text-white">Meaningful Gifting</span></li></ul>
                        <button onclick="window.addToCart(2)" class="bg-primary dark:bg-secondary text-white dark:text-gray-900 px-8 py-4 rounded-full font-bold shadow-lg hover:bg-emerald-900 dark:hover:bg-emerald-400 transition-all flex items-center gap-3 transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent"><span>Plant Your Milestone Tree</span><i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-soft border border-gray-100 dark:border-gray-700 hover:border-secondary/30 transition-all group hover:-translate-y-2"><div class="w-16 h-16 bg-green-50 dark:bg-gray-700 rounded-2xl flex items-center justify-center mb-6 text-primary dark:text-emerald-400 text-2xl group-hover:bg-primary group-hover:text-white transition-colors"><i class="fas fa-tree"></i></div><h4 class="font-bold text-lg mb-2 dark:text-white">Native Sapling</h4><p class="text-sm text-gray-500 dark:text-gray-400">High-oxygen releasing species suited to local soil.</p></div>
                    <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-soft border border-gray-100 dark:border-gray-700 hover:border-secondary/30 transition-all group hover:-translate-y-2"><div class="w-16 h-16 bg-green-50 dark:bg-gray-700 rounded-2xl flex items-center justify-center mb-6 text-primary dark:text-emerald-400 text-2xl group-hover:bg-primary group-hover:text-white transition-colors"><i class="fas fa-map-marker-alt"></i></div><h4 class="font-bold text-lg mb-2 dark:text-white">GPS Coordinates</h4><p class="text-sm text-gray-500 dark:text-gray-400">Know exactly where your legacy is rooted.</p></div>
                    <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-soft border border-gray-100 dark:border-gray-700 hover:border-secondary/30 transition-all group hover:-translate-y-2"><div class="w-16 h-16 bg-green-50 dark:bg-gray-700 rounded-2xl flex items-center justify-center mb-6 text-primary dark:text-emerald-400 text-2xl group-hover:bg-primary group-hover:text-white transition-colors"><i class="fas fa-camera"></i></div><h4 class="font-bold text-lg mb-2 dark:text-white">Growth Updates</h4><p class="text-sm text-gray-500 dark:text-gray-400">Quarterly photos of your tree for the first year.</p></div>
                    <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-soft border border-gray-100 dark:border-gray-700 hover:border-secondary/30 transition-all group hover:-translate-y-2"><div class="w-16 h-16 bg-green-50 dark:bg-gray-700 rounded-2xl flex items-center justify-center mb-6 text-primary dark:text-emerald-400 text-2xl group-hover:bg-primary group-hover:text-white transition-colors"><i class="fas fa-certificate"></i></div><h4 class="font-bold text-lg mb-2 dark:text-white">Green Certificate</h4><p class="text-sm text-gray-500 dark:text-gray-400">A framing-worthy digital certificate.</p></div>
                </div>
            </div>
        </section>

        <section id="services" class="py-24 bg-white dark:bg-gray-800 relative transition-colors duration-400">
            <div class="container mx-auto px-6 reveal">
                <div class="text-center mb-16 mt-10"><span class="text-secondary font-bold uppercase tracking-wider text-sm">Services</span><h2 class="text-4xl font-bold text-primary dark:text-white mt-2 font-serif">Planting Packages</h2></div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="product-grid"></div>
                <div class="text-center mt-16"><a href="#shop" class="inline-block bg-white dark:bg-gray-700 text-primary dark:text-white px-8 py-3 rounded-full font-bold hover:bg-primary hover:text-white dark:hover:bg-secondary dark:hover:text-gray-900 transition-all shadow-md border border-gray-200 dark:border-gray-600">View All Products</a></div>
            </div>
        </section>

        <section id="shop" class="py-24 bg-light dark:bg-gray-900 transition-colors duration-400">
            <div class="container mx-auto px-6 reveal">
                <h2 class="text-3xl font-bold text-center text-primary dark:text-white mb-12 font-serif">Shop Categories</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="group relative overflow-hidden rounded-[2.5rem] h-96 cursor-pointer shadow-lg border border-transparent dark:border-gray-800 hover:-translate-y-2 transition-transform duration-300"><img src="https://images.unsplash.com/photo-1416879595882-3373a0480b5b?auto=format&fit=crop&w=800&q=80" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="Plants" loading="lazy"><div class="absolute inset-0 bg-black/20 group-hover:bg-primary/40 transition-colors flex items-end p-8"><h3 class="text-white text-3xl font-bold font-serif">Plants</h3></div></div>
                    <div class="group relative overflow-hidden rounded-[2.5rem] h-96 cursor-pointer shadow-lg border border-transparent dark:border-gray-800 hover:-translate-y-2 transition-transform duration-300"><img src="https://images.unsplash.com/photo-1586023492125-27b2c045efd7?auto=format&fit=crop&w=800&q=80" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="Pots" loading="lazy"><div class="absolute inset-0 bg-black/20 group-hover:bg-primary/40 transition-colors flex items-end p-8"><h3 class="text-white text-3xl font-bold font-serif">Pots</h3></div></div>
                    <div class="group relative overflow-hidden rounded-[2.5rem] h-96 cursor-pointer shadow-lg border border-transparent dark:border-gray-800 hover:-translate-y-2 transition-transform duration-300"><img src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?auto=format&fit=crop&w=800&q=80" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="Subscriptions" loading="lazy"><div class="absolute inset-0 bg-black/20 group-hover:bg-primary/40 transition-colors flex items-end p-8"><h3 class="text-white text-3xl font-bold font-serif">Subscriptions</h3></div></div>
                </div>
            </div>
        </section>
    </main>

    <footer id="contact" class="bg-primary dark:bg-black text-white pt-24 pb-10 mt-10 transition-colors duration-400 relative">
        <div class="absolute top-0 left-0 w-full overflow-hidden leading-none rotate-180 -translate-y-[98%]"><svg class="relative block w-[calc(100%+1.3px)] h-[60px] wave-divider" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" class="shape-fill fill-primary dark:fill-black"></path></svg></div>
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16">
                <div><div class="flex items-center gap-3 mb-6"><div class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center"><i class="fas fa-leaf"></i></div><span class="text-2xl font-bold font-serif">RechargEarth</span></div><p class="text-gray-300 text-sm">Empowering people to make a tangible impact on the planet.</p></div>
                <div><h4 class="text-lg font-bold mb-6 text-accent">Contact</h4><ul class="space-y-4 text-sm text-gray-300"><li class="flex items-start gap-3"><i class="fas fa-map-marker-alt mt-1"></i><span>KIIT TBI, CAMPUS 11<br>KIIT University, BHUBNESHWAR</span></li><li class="flex items-center gap-3"><i class="fas fa-envelope"></i><span>rechargearthorganization@gmail.com</span></li></ul></div>
                <div class="col-span-1 md:col-span-2"><h4 class="text-lg font-bold mb-6 text-accent">Newsletter</h4><form onsubmit="event.preventDefault(); showToast('Subscribed!', 'success')" class="flex gap-3"><input type="email" placeholder="Enter your email" class="bg-white/10 border border-white/10 rounded-xl px-4 py-3 text-sm text-white w-full focus:outline-none focus:ring-2 focus:ring-accent" required><button type="submit" class="bg-accent text-primary font-bold py-3 px-6 rounded-xl hover:bg-white transition-colors">Subscribe</button></form></div>
            </div>
            <div class="border-t border-white/10 pt-8 flex justify-between items-center text-xs text-gray-400"><p>&copy; 2024 RechargEarth.</p><button onclick="document.getElementById('admin-panel').classList.add('open')" class="hover:text-white"><i class="fas fa-lock"></i> Admin</button></div>
        </div>
    </footer>

    <script>
        // UI Logic - Moved outside module to ensure it runs even if Firebase fails
        window.showToast = (msg, type) => { const t = document.createElement('div'); t.className = 'toast show'; t.innerHTML = `<i class="fas fa-${type==='success'?'check-circle text-secondary':'exclamation-circle text-red-500'} text-xl"></i><div><p class="text-sm text-gray-700 dark:text-gray-200 font-medium">${msg}</p></div>`; document.getElementById('toast-container').appendChild(t); setTimeout(() => { t.classList.remove('show'); t.classList.add('hide'); setTimeout(()=>t.remove(), 300); }, 3500); };
        window.openPledgeModal = () => { document.getElementById('pledge-modal').classList.remove('hidden'); setTimeout(() => document.getElementById('pledge-modal').classList.remove('opacity-0'), 10); };
        window.closePledgeModal = () => { document.getElementById('pledge-modal').classList.add('opacity-0'); setTimeout(() => document.getElementById('pledge-modal').classList.add('hidden'), 500); };
        window.openAuthModal = () => { document.getElementById('auth-modal').classList.remove('hidden'); setTimeout(() => document.getElementById('auth-modal').classList.remove('opacity-0'), 10); };
        window.closeAuthModal = () => { document.getElementById('auth-modal').classList.add('opacity-0'); setTimeout(() => document.getElementById('auth-modal').classList.add('hidden'), 500); };
        window.addToCart = () => { const b = document.getElementById('cart-count'); b.innerText = parseInt(b.innerText)+1; b.classList.add('animate-bounce'); setTimeout(()=>b.classList.remove('animate-bounce'), 1000); window.showToast("Added to cart"); };
        window.openCart = () => window.showToast("Checkout coming soon!", "success");
        window.toggleMobileMenu = () => { document.getElementById('mobile-menu').classList.toggle('hidden'); };
        window.toggleTheme = () => { const h = document.documentElement; if(h.classList.contains('dark')){h.classList.remove('dark');localStorage.setItem('theme','light');}else{h.classList.add('dark');localStorage.setItem('theme','dark');} };
        window.toggleAuthMode = (mode) => { if(mode === 'login') { document.getElementById('login-form').classList.remove('hidden'); document.getElementById('signup-form').classList.add('hidden'); } else { document.getElementById('login-form').classList.add('hidden'); document.getElementById('signup-form').classList.remove('hidden'); } };
        
        // Scroll Listener for Header
        const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('active'); }); }, { threshold: 0.1 });
        let ticking = false; 
        window.addEventListener('scroll', () => { 
            if (!ticking) { 
                window.requestAnimationFrame(() => { 
                    const h = document.getElementById('header'); 
                    if(window.scrollY > 50){
                        h.classList.add('scrolled');
                        h.classList.remove('bg-transparent');
                    } else {
                        h.classList.remove('scrolled');
                        h.classList.add('bg-transparent');
                    } 
                    ticking = false; 
                }); 
                ticking = true; 
            } 
        });

        document.addEventListener('DOMContentLoaded', () => {
            if (!sessionStorage.getItem('pledgeSeen')) { setTimeout(() => { window.openPledgeModal(); sessionStorage.setItem('pledgeSeen', 'true'); }, 10000); }
            const savedTheme = localStorage.getItem('theme'); if (savedTheme === 'dark') document.documentElement.classList.add('dark');
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        });
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
          apiKey: "AIzaSyAFZI3CbHREvOr4i19Pb7nhHVz-hDXax0M",
          authDomain: "rechargearth-d1f7d.firebaseapp.com",
          projectId: "rechargearth-d1f7d",
          storageBucket: "rechargearth-d1f7d.firebasestorage.app",
          messagingSenderId: "42202126738",
          appId: "1:42202126738:web:4f7a58287f8f863e7e094b",
          measurementId: "G-L16KHXPKMH"
        };
        
        const appId = 'default-app-id';
        
        let db, auth, analytics;
        const googleProvider = new GoogleAuthProvider();
        const ADMIN_EMAIL = "admin@rechargearth.com"; 

        // Default Products (Fallback)
        const defaultProducts = [
            { name: "Tree Planting", price: 500, desc: "Plant a native tree in a deforested area.", image: "https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?auto=format&fit=crop&w=800&q=80" },
            { name: "Birthday Park", price: 223, desc: "Celebrate your special day by gifting the earth.", image: "https://images.unsplash.com/photo-1530968464165-7a1861cbaf9f?auto=format&fit=crop&w=800&q=80", featured: true },
            { name: "Real-Time Tracking", price: 222, desc: "GPS coordinates and photo updates.", image: "https://images.unsplash.com/photo-1569336415962-a4bd9f69cd83?auto=format&fit=crop&w=800&q=80" },
            { name: "Corporate CSR", price: 1123, desc: "Solutions for carbon footprint.", image: "https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&w=800&q=80" },
            { name: "School Programs", price: 5000, desc: "Educational workshops and drives.", image: "https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&w=800&q=80" },
            { name: "Urban Greening", price: 1000, desc: "Micro-forests in city limits.", image: "https://images.unsplash.com/photo-1416879595882-3373a0480b5b?auto=format&fit=crop&w=800&q=80" }
        ];

        // Initialize Firebase
        try {
            const app = initializeApp(firebaseConfig);
            analytics = getAnalytics(app);
            db = getFirestore(app);
            auth = getAuth(app);
        } catch (e) { 
            console.error("Firebase Init Error:", e);
            // Don't block UI, but auth won't work
        }

        // Security: Sanitize inputs to prevent XSS
        function sanitizeHTML(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }

        const initAuth = async () => {
            if (!auth) return;
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    // Optional: Sign in anonymously by default if you want public users to have an ID
                    // if (!auth.currentUser) await signInAnonymously(auth);
                }
            } catch (e) { console.error("Auth Init Failed", e); }
        };

        /* --- DATA HANDLING (PRODUCTS) --- */
        async function loadProducts() {
            const grid = document.getElementById('product-grid');
            if (!grid) return;
            grid.innerHTML = '<div class="col-span-3 text-center py-10"><i class="fas fa-spinner fa-spin text-2xl text-primary"></i></div>';

            if (!db) { renderProducts(defaultProducts); return; }

            try {
                 const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'products'));
                 const snapshot = await getDocs(q);
                 let products = [];
                 
                 if (snapshot.empty) {
                     products = defaultProducts;
                 } else {
                     snapshot.forEach(doc => products.push({ id: doc.id, ...doc.data() }));
                 }
                 renderProducts(products);
            } catch (e) {
                console.error("Error loading products:", e);
                renderProducts(defaultProducts); // Fallback
            }
        }

        function renderProducts(products) {
            const grid = document.getElementById('product-grid');
            if (!grid) return;
            grid.innerHTML = products.map(p => `
                <div class="product-card bg-white dark:bg-gray-800 rounded-3xl overflow-hidden shadow-sm border border-gray-100 dark:border-gray-700 relative flex flex-col h-full group reveal">
                    ${p.featured ? '<span class="absolute top-4 right-4 bg-accent text-white text-[10px] font-bold px-3 py-1 rounded-full z-10 shadow-sm uppercase tracking-wider">Best Value</span>' : ''}
                    <div class="h-56 overflow-hidden relative"><img src="${p.image}" alt="${p.name}" width="800" height="600" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" loading="lazy"></div>
                    <div class="p-8 flex flex-col flex-1">
                        <h3 class="text-xl font-bold text-primary dark:text-white mb-2 font-serif">${p.name}</h3>
                        <p class="text-gray-500 dark:text-gray-400 text-sm mb-6 flex-1 leading-relaxed">${p.desc}</p>
                        <div class="flex items-center justify-between pt-4 border-t border-gray-50 dark:border-gray-700"><span class="text-2xl font-bold text-dark dark:text-white">â‚¹${p.price}</span><button onclick="window.addToCart('${p.id || p.name}')" class="bg-secondary hover:bg-primary dark:hover:bg-emerald-400 dark:hover:text-gray-900 text-white px-4 py-2 rounded-full transition-all add-btn shadow-lg" aria-label="Add to cart"><i class="fas fa-plus"></i></button></div>
                    </div>
                </div>
            `).join('');
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        }

        /* --- ADMIN LOGIC --- */
        window.switchAdminTab = (tab) => {
            document.getElementById('view-pledges').classList.add('hidden');
            document.getElementById('view-products').classList.add('hidden');
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            
            document.getElementById('tab-pledges').className = tab === 'pledges' ? "px-4 py-1.5 rounded-md text-sm font-bold bg-white dark:bg-gray-600 shadow-sm text-primary dark:text-white transition-all" : "px-4 py-1.5 rounded-md text-sm font-bold text-gray-500 dark:text-gray-400 hover:text-primary transition-all";
            document.getElementById('tab-products').className = tab === 'products' ? "px-4 py-1.5 rounded-md text-sm font-bold bg-white dark:bg-gray-600 shadow-sm text-primary dark:text-white transition-all" : "px-4 py-1.5 rounded-md text-sm font-bold text-gray-500 dark:text-gray-400 hover:text-primary transition-all";
        }

        window.handleAddProduct = async (e) => {
            e.preventDefault();
            if (!auth || auth.currentUser?.email !== ADMIN_EMAIL) { window.showToast("Unauthorized Action", "error"); return; }
            
            const btn = e.target.querySelector('button');
            const oldText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Adding...';
            btn.disabled = true;

            // Sanitize
            const name = sanitizeHTML(e.target.name.value);
            const desc = sanitizeHTML(e.target.desc.value);
            const image = sanitizeHTML(e.target.image.value);

            const newProduct = {
                name: name,
                price: Number(e.target.price.value),
                image: image,
                desc: desc,
                timestamp: serverTimestamp()
            };

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'products'), newProduct);
                window.showToast("Product Added Successfully", "success");
                e.target.reset();
                loadProducts(); // Refresh main grid
            } catch (err) { window.showToast("Error adding product", "error"); }
            finally { btn.innerHTML = oldText; btn.disabled = false; }
        }

        window.deleteProduct = async (id) => {
            if (!confirm("Delete this product?")) return;
            if (!auth) return;
            try {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', id));
                window.showToast("Product deleted", "success");
                loadProducts();
            } catch (e) { window.showToast("Error deleting", "error"); }
        }

        function setupAdminListeners() {
            if (!db) return;
            
            // Pledges Listener
            const qPledges = query(collection(db, 'artifacts', appId, 'public', 'data', 'pledges'), orderBy("timestamp", "desc"));
            onSnapshot(qPledges, (snap) => {
                const pledges = [];
                snap.forEach(doc => pledges.push({ id: doc.id, ...doc.data() }));
                renderAdminTable(pledges);
                document.getElementById('stat-total-pledges').innerText = pledges.length;
                document.getElementById('stat-community').innerText = pledges.length + 1240;
            });

            // Products Listener (For Admin List)
            const qProducts = query(collection(db, 'artifacts', appId, 'public', 'data', 'products'));
            onSnapshot(qProducts, (snap) => {
                const products = [];
                snap.forEach(doc => products.push({ id: doc.id, ...doc.data() }));
                const tbody = document.getElementById('admin-product-list');
                tbody.innerHTML = products.map(p => `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                        <td class="p-4"><img src="${p.image}" class="w-12 h-12 rounded-lg object-cover"></td>
                        <td class="p-4"><div class="font-bold text-gray-800 dark:text-white">${p.name}</div><div class="text-xs text-gray-500">â‚¹${p.price}</div></td>
                        <td class="p-4 text-right"><button onclick="window.deleteProduct('${p.id}')" class="text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button></td>
                    </tr>
                `).join('');
            });
        }

        // -------------------- COMMON LOGIC -------------------- //

        function renderAdminTable(pledges) {
            const tbody = document.getElementById('pledge-table-body');
            const loading = document.getElementById('loading-state');
            const empty = document.getElementById('empty-state');
            if (!tbody) return;
            tbody.innerHTML = '';
            loading.style.display = 'none';
            if (pledges.length === 0) { empty.style.display = 'block'; return; }
            empty.style.display = 'none';
            pledges.forEach(data => {
                const row = document.createElement('tr');
                row.className = "hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors";
                const dateStr = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString() : 'N/A';
                row.innerHTML = `<td class="p-5 text-gray-500 dark:text-gray-400 font-mono text-xs">${dateStr}</td><td class="p-5"><div class="font-bold text-primary dark:text-white">${data.fullName}</div></td><td class="p-5 text-gray-600 dark:text-gray-300 text-xs">${data.email}</td><td class="p-5 text-right"><button onclick="window.deletePledge('${data.id}')" class="text-red-400 hover:text-red-600 transition-colors"><i class="fas fa-trash"></i></button></td>`;
                tbody.appendChild(row);
            });
        }

        window.deletePledge = async (id) => { if (confirm("Delete pledge?")) { try { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'pledges', id)); window.showToast("Deleted", "success"); } catch(e){ window.showToast("Error", "error"); } } };

        // Auth State Handler
        onAuthStateChanged(auth, (user) => {
            const adminTrigger = document.getElementById('admin-trigger');
            const authUI = document.getElementById('auth-ui-container');
            const mobileAuthBtn = document.getElementById('mobile-auth-btn');

            if (user) {
                // Logged In
                const label = (user.email || user.displayName || 'U')[0].toUpperCase();
                authUI.innerHTML = `
                    <div class="flex items-center gap-3 group relative cursor-pointer" onclick="this.querySelector('.dropdown-menu').classList.toggle('hidden')">
                        <div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold text-sm">${label}</div>
                        <div class="dropdown-menu absolute right-0 top-full mt-2 w-32 bg-white dark:bg-gray-800 rounded-lg shadow-xl p-2 hidden z-50">
                            <button onclick="window.handleLogout()" class="w-full text-left px-3 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded">Logout</button>
                        </div>
                    </div>
                `;
                
                if(mobileAuthBtn) {
                    mobileAuthBtn.innerText = "Logout";
                    mobileAuthBtn.onclick = window.handleLogout;
                }

                if (user.email === ADMIN_EMAIL) {
                    adminTrigger.classList.remove('hidden');
                    setupAdminListeners();
                } else {
                    adminTrigger.classList.add('hidden');
                }
                loadProducts(); 
            } else {
                // Guest
                authUI.innerHTML = `<button onclick="openAuthModal()" class="border-2 px-5 py-2 rounded-full text-sm font-bold transition-all auth-btn border-white/40 text-white hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-accent">Sign In</button>`;
                
                if(mobileAuthBtn) {
                    mobileAuthBtn.innerText = "Sign In";
                    mobileAuthBtn.onclick = window.openAuthModal;
                }

                adminTrigger.classList.add('hidden');
                loadProducts(); 
            }
        });

        window.handleLogout = async () => {
            try {
                await signOut(auth);
                window.showToast("Logged Out", "success");
            } catch (e) { console.error(e); }
        }

        window.handleLogin = async (e) => { 
            e.preventDefault(); 
            const btn = document.querySelector('#login-form button');
            const old = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            try { await signInWithEmailAndPassword(auth, e.target.email.value, e.target.password.value); window.showToast("Welcome back!", "success"); window.closeAuthModal(); } 
            catch(e) { window.showToast("Login failed: " + e.message, "error"); btn.innerHTML = old; } 
        };

        window.handleSignup = async (e) => { 
            e.preventDefault(); 
            const btn = document.querySelector('#signup-form button');
            const old = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            try { await createUserWithEmailAndPassword(auth, e.target.email.value, e.target.password.value); window.showToast("Account created!", "success"); window.closeAuthModal(); } 
            catch(e) { window.showToast("Signup failed: " + e.message, "error"); btn.innerHTML = old; } 
        };
        
        window.handleGoogleLogin = async () => {
            try {
                await signInWithPopup(auth, googleProvider);
                window.showToast("Welcome back!", "success");
                window.closeAuthModal();
            } catch (e) {
                console.error(e);
                window.showToast("Google login failed", "error");
            }
        };

        window.handleModalPledge = async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const old = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...'; btn.disabled = true;
            
            const firstName = sanitizeHTML(e.target.firstName.value);
            const lastName = sanitizeHTML(e.target.lastName.value);
            const email = sanitizeHTML(e.target.email.value);
            const phone = sanitizeHTML(e.target.phone.value);

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'pledges'), {
                    firstName: firstName, lastName: lastName, fullName: `${firstName} ${lastName}`, email: email, phone: phone, birthday: e.target.birthday.value, timestamp: serverTimestamp()
                });
                window.showToast("Welcome to the family!", 'success');
                document.getElementById('modal-form-container').classList.add('hidden');
                document.getElementById('modal-success').classList.remove('hidden');
                document.getElementById('modal-success').classList.add('flex');
            } catch(err) { window.showToast("Error saving", 'error'); } finally { btn.innerHTML = old; btn.disabled = false; }
        };

        initAuth(); 
    </script>
</body>
</html>